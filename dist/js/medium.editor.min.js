/*! medium.editor 2013-05-30 */
function mediumEditor(a,b){"use strict";return this.init(a,b)}!function(a,b){"use strict";function c(){var c,d,e,f;if(a.getSelection){if(f=a.getSelection(),f.getRangeAt&&f.rangeCount){for(e=[],c=0,d=f.rangeCount;d>c;c+=1)e.push(f.getRangeAt(c));return e}}else if(b.selection&&b.selection.createRange)return b.selection.createRange();return null}function d(c){var d,e,f;if(c)if(a.getSelection)for(f=a.getSelection(),f.removeAllRanges(),d=0,e=c.length;e>d;d+=1)f.addRange(c[d]);else b.selection&&c.select&&c.select()}function e(c){var d=b.createRange(),e=a.getSelection();d.selectNodeContents(c),e.removeAllRanges(),e.addRange(d)}function f(c){var d,e=b.createElement(c),f=void 0!==a.getComputedStyle;return b.body.appendChild(e),d=(f?a.getComputedStyle(e,""):e.currentStyle).display,b.body.removeChild(e),d}function g(a){var b=0,c=0;if(a.offsetParent)do b+=a.offsetLeft,c+=a.offsetTop,a=a.offsetParent;while(a.offsetParent);return[b,c]}mediumEditor.prototype={init:function(a){return this.initElements(a).initToolbar().bindSelect().bindButtons().bindAnchorForm()},initElements:function(a){var c,d=b.querySelectorAll(a);for(c=0;c<d.length;c+=1)d[c].setAttribute("contentEditable",!0);return this},initToolbar:function(){return this.toolbar=this.getOrCreateToolbar(),this.keepToolbarAlive=!1,this.anchorForm=b.getElementById("medium-editor-toolbar-form-anchor"),this.toolbarActions=b.getElementById("medium-editor-toolbar-actions"),this},getOrCreateToolbar:function(){var a=b.getElementById("medium-editor-toolbar");return null===a&&(a=b.createElement("div"),a.id="medium-editor-toolbar",a.className="medium-editor-toolbar",a.innerHTML='<ul class="clearfix" id="medium-editor-toolbar-actions">    <li><a href="#" data-action="bold" data-element="b">B</a></li>    <li><a href="#" data-action="italic" data-element="i">I</a></li>    <li><a href="#" data-action="underline" data-element="u">S</a></li>    <li><a href="#" data-action="anchor" data-element="a">#</a></li>    <li><a href="#" data-action="append-h3" data-element="h3">h1</a></li>    <li><a href="#" data-action="append-h4" data-element="h4">h2</a></li>    <li><a href="#" data-action="append-blockquote" data-element="blockquote">"</a></li></ul><div class="medium-editor-toolbar-form-anchor" id="medium-editor-toolbar-form-anchor">    <input type="text" value="" placeholder="Digite ou cole um link"><a href="#">x</a></div>',b.getElementsByTagName("body")[0].appendChild(a)),a},bindSelect:function(){var a=this;return b.onmouseup=function(b){a.checkSelection(b)},b.onkeyup=function(b){a.checkSelection(b)},this},checkSelection:function(){var b;return this.keepToolbarAlive!==!0&&(b=a.getSelection(),""===b.toString().trim()?this.toolbar.style.display="none":(this.selection=b,this.selectionRange=this.selection.getRangeAt(0),this.setToolbarPosition(),this.setToolbarButtonStates(),this.toolbar.style.display="block",this.showToolbarActions())),this},setToolbarPosition:function(){var a=this.getSelectionCoordinates();this.toolbar.style.left=a[0]+20+"px",this.toolbar.style.top=a[1]+20+"px"},setToolbarButtonStates:function(){var a,b=this.toolbar.querySelectorAll("a"),c=this.selection.anchorNode.parentNode;for(a=0;a<b.length;a+=1)b[a].classList.remove("medium-editor-button-active");for(;"block"!==f(c.tagName);)this.activateButton(c.tagName.toLowerCase()),c=c.parentNode;this.activateButton(c.tagName.toLowerCase())},activateButton:function(a){var b=this.toolbar.querySelector('a[data-element="'+a+'"]');null!==b&&b.classList.add("medium-editor-button-active")},getSelectionCoordinates:function(){var a,c=b.createElement("span"),d=this.selection.getRangeAt(0);return c.innerHTML=this.selection.toString(),c.style.backgroundColor="red",d.insertNode(c),a=g(c),c.parentNode.removeChild(c),this.selection.addRange(d),[a[0],a[1]]},bindButtons:function(){var a,c,d=this.toolbar.querySelectorAll("a"),e=this,f=function(c){c.preventDefault(),this.classList.toggle("medium-editor-button-active"),a=this.getAttribute("data-action"),a.indexOf("append-")>-1?e.appendEl(a.replace("append-","")):"anchor"===a?"a"===e.selection.anchorNode.parentNode.tagName.toLowerCase()?b.execCommand("unlink",null,!1):"block"===e.anchorForm.style?e.showToolbarActions():e.showAnchorForm():b.execCommand(a,null,!1)};for(c=0;c<d.length;c+=1)d[c].onclick=f;return this},appendEl:function(a){var c=this.selection.anchorNode.parentNode,d=c.tagName.toLowerCase();for((d===a||"span"===d)&&(a="p");"block"!==f(d);)c=c.parentNode,d=c.tagName.toLowerCase();a=b.createElement(a),a.innerHTML=c.innerHTML,a.setAttribute("contentEditable",!0),c.parentNode.replaceChild(a,c),e(a.firstChild),this.setToolbarPosition()},showToolbarActions:function(){this.anchorForm.style.display="none",this.toolbarActions.style.display="block",this.keepToolbarAlive=!1,b.onclick=""},showAnchorForm:function(){var a=this.anchorForm.querySelector("input"),d=this;this.toolbarActions.style.display="none",this.savedSelection=c(),this.anchorForm.style.display="block",this.keepToolbarAlive=!0,a.focus(),a.value="",clearTimeout(this.timer),this.timer=setTimeout(function(){b.onclick=function(){d.keepToolbarAlive=!1,d.toolbar.style.display="none",this.onclick=""}},300)},bindAnchorForm:function(){var a=this.anchorForm.querySelector("input"),b=this.anchorForm.querySelector("a"),c=this;this.anchorForm.onclick=function(a){a.stopPropagation()},a.onkeydown=function(a){13===a.keyCode&&(a.preventDefault(),c.createLink(this))},b.onclick=function(){c.showToolbarActions(),d(c.savedSelection)}},createLink:function(a){d(this.savedSelection),b.execCommand("CreateLink",!1,a.value),this.showToolbarActions(),a.value=""}}}(window,document);