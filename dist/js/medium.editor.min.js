function MediumEditor(a,b){"use strict";return this.init(a,b)}!function(a,b){"use strict";function c(a,b){var c;if(void 0===a)return b;for(c in b)b.hasOwnProperty(c)&&a.hasOwnProperty(c)===!1&&(a[c]=b[c]);return a}function d(){return void 0!==a.pageYOffset?a.pageYOffset:(b.documentElement||b.body.parentNode||b.body).scrollTop}function e(){var c,d,e,f;if(a.getSelection){if(f=a.getSelection(),f.getRangeAt&&f.rangeCount){for(e=[],c=0,d=f.rangeCount;d>c;c+=1)e.push(f.getRangeAt(c));return e}}else if(b.selection&&b.selection.createRange)return b.selection.createRange();return null}function f(c){var d,e,f;if(c)if(a.getSelection)for(f=a.getSelection(),f.removeAllRanges(),d=0,e=c.length;e>d;d+=1)f.addRange(c[d]);else b.selection&&c.select&&c.select()}function g(){var c,d,e=b.selection,f=0,g=0;return e?"Control"!==e.type&&(c=e.createRange(),c.collapse(!0),f=c.boundingLeft,g=c.boundingTop):a.getSelection&&(e=a.getSelection(),e.rangeCount&&(c=e.getRangeAt(0).cloneRange(),c.getClientRects&&(c.collapse(!0),d=c.getClientRects()[0],f=d.left,g=d.top))),[f,g]}function h(){var c,d,e=b.selection,f=0,g=0;return e?"Control"!==e.type&&(c=e.createRange(),f=c.boundingWidth,g=c.boundingHeight):a.getSelection&&(e=a.getSelection(),e.rangeCount&&(c=e.getRangeAt(0).cloneRange(),c.getBoundingClientRect&&(d=c.getBoundingClientRect(),f=d.right-d.left,g=d.bottom-d.top))),[f,g]}function i(c){var d,e;b.body.createTextRange?(d=b.body.createTextRange(),d.moveToElementText(c),d.select()):a.getSelection&&(e=a.getSelection(),d=b.createRange(),d.selectNodeContents(c),e.removeAllRanges(),e.addRange(d))}MediumEditor.prototype={defaults:{excludedActions:[],anchorInputPlaceholder:"Paste or type a link",diffLeft:0,diffTop:-5,firstHeader:"h3",secondHeader:"h4",delay:0},init:function(a,d){return this.elements=b.querySelectorAll(a),0!==this.elements.length?(this.parentElements=["p","h1","h2","h3","h4","h5","h6","q"],this.id=b.querySelectorAll(".medium-editor-toolbar").length+1,this.options=c(d,this.defaults),this.initElements(a).initToolbar().bindSelect().bindButtons().bindAnchorForm()):void 0},initElements:function(){var a;for(a=0;a<this.elements.length;a+=1)this.elements[a].setAttribute("contentEditable",!0);return this},toolbarTemplate:function(){return'<ul id="medium-editor-toolbar-actions" class="medium-editor-toolbar-actions clearfix">    <li><button class="medium-editor-action medium-editor-action-bold" data-action="bold" data-element="b">B</button></li>    <li><button class="medium-editor-action medium-editor-action-italic" data-action="italic" data-element="i">I</button></li>    <li><button class="medium-editor-action medium-editor-action-underline" data-action="underline" data-element="u">S</button></li>    <li><button class="medium-editor-action medium-editor-action-anchor" data-action="anchor" data-element="a">#</button></li>    <li><button class="medium-editor-action medium-editor-action-header1" data-action="append-'+this.options.firstHeader+'" data-element="'+this.options.firstHeader+'">h1</button></li>'+'    <li><button class="medium-editor-action medium-editor-action-header2" data-action="append-'+this.options.secondHeader+'" data-element="'+this.options.secondHeader+'">h2</button></li>'+'    <li><button class="medium-editor-action medium-editor-action-quote" data-action="append-q" data-element="q">&ldquo;</button></li>'+"</ul>"+'<div class="medium-editor-toolbar-form-anchor" id="medium-editor-toolbar-form-anchor">'+'    <input type="text" value="" placeholder="'+this.options.anchorInputPlaceholder+'"><a href="#">&times;</a>'+"</div>"},initToolbar:function(){return this.toolbar=this.createToolbar(),this.keepToolbarAlive=!1,this.anchorForm=this.toolbar.querySelector(".medium-editor-toolbar-form-anchor"),this.toolbarActions=this.toolbar.querySelector(".medium-editor-toolbar-actions"),this},createToolbar:function(){var a=b.createElement("div");return a.id="medium-editor-toolbar-"+this.id,a.className="medium-editor-toolbar",a.innerHTML=this.toolbarTemplate(),b.getElementsByTagName("body")[0].appendChild(a),a},bindSelect:function(){var a,b=this,c="",d=function(a){clearTimeout(c),setTimeout(function(){b.checkSelection(a)},b.options.delay)};for(a=0;a<this.elements.length;a+=1)this.elements[a].onmouseup=d,this.elements[a].onkeyup=d;return this},checkSelection:function(){var b;return this.keepToolbarAlive!==!0&&(b=a.getSelection(),""===b.toString().trim()?this.toolbar.style.display="none":(this.selection=b,this.selectionRange=this.selection.getRangeAt(0),this.toolbar.style.display="block",this.setToolbarPosition().setToolbarButtonStates().showToolbarActions())),this},setToolbarPosition:function(){var a=g(),b=h();return this.toolbar.style.left=a[0]-this.toolbar.offsetWidth/2+b[0]/2+this.options.diffLeft+"px",this.toolbar.style.top=a[1]+d()-this.toolbar.offsetHeight+this.options.diffTop+"px",this},setToolbarButtonStates:function(){var a,b=this.toolbarActions.querySelectorAll("button");for(a=0;a<b.length;a+=1)b[a].className=b[a].className.replace(/medium-editor-button-active/g,"").replace(/\s{2}/g," "),this.showHideButton(b[a]);return this.checkActiveButtons(),this},showHideButton:function(a){a.style.display=this.options.excludedActions.indexOf(a.getAttribute("data-element"))>-1?"none":"block"},checkActiveButtons:function(){for(var a=this.selection.anchorNode.parentNode;void 0!==a.tagName&&-1===this.parentElements.indexOf(a.tagName);)this.activateButton(a.tagName.toLowerCase()),a=a.parentNode},activateButton:function(a){var b=this.toolbar.querySelector('[data-element="'+a+'"]');null!==b&&-1===b.className.indexOf("medium-editor-button-active")&&(b.className+=" medium-editor-button-active")},bindButtons:function(){var a,b=this.toolbar.querySelectorAll("button"),c=this,d=function(a){a.preventDefault(),a.stopPropagation(),void 0===c.selection&&c.checkSelection(a),this.className.indexOf("medium-editor-button-active")>-1?this.className=this.className.replace(/medium-editor-button-active/g,"").replace(/\s{2}/g," "):this.className+=" medium-editor-button-active",c.execAction(this.getAttribute("data-action"),a)};for(a=0;a<b.length;a+=1)b[a].onclick=d;return this},execAction:function(a,c){a.indexOf("append-")>-1?(this.appendEl(a.replace("append-","")),this.setToolbarButtonStates()):"anchor"===a?this.triggerAnchorAction(c):b.execCommand(a,null,!1)},triggerAnchorAction:function(){return"a"===this.selection.anchorNode.parentNode.tagName.toLowerCase()?b.execCommand("unlink",null,!1):"block"===this.anchorForm.style.display?this.showToolbarActions():this.showAnchorForm(),this},appendEl:function(a){for(var c=this.selection.anchorNode.parentNode,d=c.tagName.toLowerCase();-1===this.parentElements.indexOf(d);)c=c.parentNode,d=c.tagName.toLowerCase();d===a&&(a="p"),a=b.createElement(a),this.transferAttributes(c,a),a.innerHTML=c.innerHTML,c.parentNode.replaceChild(a,c),i(this.getFirstChild(a)||a),this.bindElementToolbarEvents(a),this.setToolbarPosition()},transferAttributes:function(a,b){Array.prototype.slice.call(a.attributes).forEach(function(a){b.setAttribute(a.name,a.value)})},getFirstChild:function(a){for(var b=a.firstChild;null!==b&&1!==b.nodeType;)b=b.nextSibling;return b},bindElementToolbarEvents:function(a){var b=this;a.onmouseup=function(a){b.checkSelection(a)},a.onkeyup=function(a){b.checkSelection(a)}},showToolbarActions:function(){var a,c=this;this.anchorForm.style.display="none",this.toolbarActions.style.display="block",this.keepToolbarAlive=!1,clearTimeout(a),a=setTimeout(function(){b.onclick=function(){c.keepToolbarAlive=!1,c.toolbar.style.display="none",this.onclick=""}},300)},showAnchorForm:function(){var a=this.anchorForm.querySelector("input");this.toolbarActions.style.display="none",this.savedSelection=e(),this.anchorForm.style.display="block",this.keepToolbarAlive=!0,a.focus(),a.value=""},bindAnchorForm:function(){var a=this.anchorForm.querySelector("input"),b=this.anchorForm.querySelector("a"),c=this;this.anchorForm.onclick=function(a){a.stopPropagation()},a.onkeyup=function(a){13===a.keyCode&&(a.preventDefault(),c.createLink(this))},b.onclick=function(){c.showToolbarActions(),f(c.savedSelection)}},createLink:function(a){f(this.savedSelection),b.execCommand("CreateLink",!1,a.value),this.showToolbarActions(),a.value=""}}}(window,document);