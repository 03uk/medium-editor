/*! medium.editor 2013-05-29 */
function saveSelection(){"use strict";var a,b,c,d;if(window.getSelection){if(d=window.getSelection(),d.getRangeAt&&d.rangeCount){for(c=[],a=0,b=d.rangeCount;b>a;a+=1)c.push(d.getRangeAt(a));return c}}else if(document.selection&&document.selection.createRange)return document.selection.createRange();return null}function restoreSelection(a){"use strict";var b,c,d;if(a)if(window.getSelection)for(d=window.getSelection(),d.removeAllRanges(),b=0,c=a.length;c>b;b+=1)d.addRange(a[b]);else document.selection&&a.select&&a.select()}function selectElementContents(a){"use strict";var b=document.createRange(),c=window.getSelection();b.selectNodeContents(a),c.removeAllRanges(),c.addRange(b)}function getElementDefaultDisplay(a){"use strict";var b,c=document.createElement(a),d=void 0!==window.getComputedStyle;return document.body.appendChild(c),b=(d?window.getComputedStyle(c,""):c.currentStyle).display,document.body.removeChild(c),b}var mediumEditor;!function(a,b){"use strict";mediumEditor={init:function(a){this.root=a,this.initToolbar().bindSelect().bindButtons().bindAnchorForm()},initToolbar:function(){return this.toolbar=b.getElementById("toolbar"),this.keepToolbarAlive=!1,this.anchorForm=b.getElementById("toolbar-form-anchor"),this.toolbarActions=b.getElementById("toolbar-actions"),this},bindSelect:function(){var a=this;return b.onmouseup=function(b){a.checkSelection(b)},b.onkeyup=function(b){a.checkSelection(b)},this},checkSelection:function(){var b;return this.keepToolbarAlive!==!0&&(b=a.getSelection(),""===b.toString().trim()?this.toolbar.style.display="none":(this.selection=b,this.selectionRange=this.selection.getRangeAt(0),this.setToolbarPosition(),this.toolbar.style.display="block",this.showToolbarActions())),this},setToolbarPosition:function(){var a=this.getSelectionCoordinates();this.toolbar.style.left=a[0]+20+"px",this.toolbar.style.top=a[1]+20+"px"},getSelectionCoordinates:function(){var a,c=b.createElement("span"),d=this.selection.getRangeAt(0);return d.insertNode(c),a=c.getBoundingClientRect(),c.parentNode.removeChild(c),this.selection.addRange(d),[a.left,a.top]},bindButtons:function(){var a,c,d=this.toolbar.querySelectorAll("a"),e=this,f=function(c){c.preventDefault(),a=this.getAttribute("data-action"),a.indexOf("append-")>-1?e.appendEl(a.replace("append-","")):"anchor"===a?"a"===e.selection.anchorNode.parentNode.tagName.toLowerCase()?b.execCommand("unlink",null,!1):"block"===e.anchorForm.style?e.showToolbarActions():e.showAnchorForm():b.execCommand(a,null,!1)};for(c=0;c<d.length;c+=1)d[c].onclick=f;return this},appendEl:function(a){var c=this.selection.anchorNode.parentNode;(c.tagName.toLowerCase()===a||"span"===c.tagName.toLowerCase())&&(a="p"),"block"!==getElementDefaultDisplay(c.tagName)&&(c=c.parentNode),a=b.createElement(a),a.innerHTML=c.innerHTML,a.setAttribute("contentEditable",!0),c.parentNode.replaceChild(a,c),selectElementContents(a),this.setToolbarPosition()},showToolbarActions:function(){this.anchorForm.style.display="none",this.toolbarActions.style.display="block",this.keepToolbarAlive=!1,b.onclick=""},showAnchorForm:function(){var a=this.anchorForm.querySelector("input"),c=this;this.toolbarActions.style.display="none",this.savedSelection=saveSelection(),this.anchorForm.style.display="block",this.keepToolbarAlive=!0,a.focus(),a.value="",clearTimeout(this.timer),this.timer=setTimeout(function(){b.onclick=function(){c.keepToolbarAlive=!1,c.toolbar.style.display="none",this.onclick=""}},300)},bindAnchorForm:function(){var a=this.anchorForm.querySelector("input"),b=this.anchorForm.querySelector("a"),c=this;this.anchorForm.onclick=function(a){a.stopPropagation()},a.onkeydown=function(a){13===a.keyCode&&(a.preventDefault(),c.createLink(this))},b.onclick=function(){c.showToolbarActions(),restoreSelection(c.savedSelection)}},createLink:function(a){restoreSelection(this.savedSelection),b.execCommand("CreateLink",!1,a.value),this.showToolbarActions(),a.value=""}}}(window,document);